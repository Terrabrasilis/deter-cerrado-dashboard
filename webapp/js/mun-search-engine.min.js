var SearchEngine={top10ByMunChartReference:null,stateChartReference:null,munGroup:null,init:function(munChart,stateChart,idModal){this.top10ByMunChartReference=munChart,this.stateChartReference=stateChart,this.munGroup=this.top10ByMunChartReference.dimension().group().reduceCount((function(d){return d})),this.injectSearchModalWindow(idModal)},injectSearchModalWindow:function(idModal){var modalHTML='<div class="modal fade" id="modal-container-filtered"><div class="modal-dialog logo-card"><div class="modal-content modalinf"><div class="modal-header fechar"><h5 class="modal-title boxtitletable"> <span id="txt1f">Pesquisa de municípios</span></h5><button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="material-icons">clear</i></button></div><div class="modal-body"><span id="txt1g">Encontre um município.</span><div class="input-group input-group-sm" style="margin-bottom: 15px;"><input autofocus id="search-county" onkeypress="SearchEngine.searchCountyByEnterKey(event)" type="text" class="form-control" placeholder="Search"><label><button class="btn btngreen" data-dismiss="modal" onclick="SearchEngine.searchCounty()" style="padding:0px;"><i class="material-icons">search</i></button></label></div><span id="txt1h" style="display:none;">Selecione um item na lista de municípios encontrados.</span><div class="counties-list"><ul id="filtered-list"></ul></div></div><div class="modal-footer"><div class="checkbox pull-right"><label><button type="button" class="btn btngreen" data-dismiss="modal"><span id="txt1i">Fechar</span></button></label></div></div></div></div></div>';$("#"+idModal).html(modalHTML)},searchCountyByEnterKey:function(key){return 13==key.keyCode&&SearchEngine.searchCounty(),key},searchCounty:function(){var r=SearchEngine.findInArray(this.munGroup.all(),$("#search-county")[0].value);r.length>0&&this.stateChartReference.hasFilter()&&(r=SearchEngine.findUsingStates(r,this.stateChartReference.filters())),1==r.length?SearchEngine.selectedItem(r[0].key,r[0].value):this.showFilteredItems(r)},showFilteredItems:function(r){0==r.length?$("#txt1h").hide():$("#txt1h").show(),document.getElementById("filtered-list").innerHTML=0==r.length?Translation[Lang.language].not_found:"",r.forEach((function(o){var m=o.key.replace("'","´");document.getElementById("filtered-list").innerHTML+="<li><a href=\"javascript:SearchEngine.selectedItem('"+m+"',"+o.value+');">'+m+"</a></li>"})),$("#modal-container-filtered").modal("show")},selectedItem:function(key,value){$("#modal-container-filtered").modal("hide"),SearchEngine.applyCountyFilter([{key:key.replace("´","'"),value:value}])},findInArray:function(anArray,substring){var found;return substring=substring.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),$.grep(anArray,(function(value,i){return value.key.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").indexOf(substring)>=0}))},findUsingStates:function(anArray,states){var found=[];return states.forEach(state=>{found=found.concat($.grep(anArray,(function(value,i){return value.key.split("/")[1]===state})))}),found},applyCountyFilter:function(d){d&&d.length?(this.top10ByMunChartReference.data((function(group){var filteredGroup=[],index,allItems=group.top(1/0);allItems.findIndex((function(item,i){item.key==d[0].key&&(index=i,filteredGroup.push({key:item.key,value:item.value}))}));for(var ctl=1,max=[],min=[];ctl<=5;){var item=allItems[index+ctl];item&&min.push({key:item.key,value:item.value}),(item=allItems[index-ctl])&&max.push({key:item.key,value:item.value}),++ctl}return filteredGroup=filteredGroup.concat(max),min.reverse(),(filteredGroup=min.concat(filteredGroup)).reverse(),filteredGroup})),this.top10ByMunChartReference.filter(d[0].key),dc.redrawAll()):this.top10ByMunChartReference.data((function(group){var fakeGroup=[];return fakeGroup.push({key:Translation[Lang.language].no_value,value:0}),group.all().length>0?group.top(10):fakeGroup}))}};