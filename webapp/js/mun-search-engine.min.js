var SearchEngine={top10ByMunChartReference:null,stateChartReference:null,munGroup:null,modalContent:null,msf_ui:[],msf:[],msf_all:[],enableCtl:!1,init:function(munChart,stateChart,idModal){this.modalContent=idModal,this.top10ByMunChartReference=munChart,this.stateChartReference=stateChart,this.munGroup=this.top10ByMunChartReference.group().all(),this.rebuildModalWindow()},rebuildModalWindow:function(){var modalHTML='<div class="modal fade" id="modal-container-filtered"><div class="modal-dialog logo-card"><div class="modal-content modalinf"><div class="modal-header fechar"><h5 class="modal-title boxtitletable"><span>'+Translation[Lang.language].txt1f+'</span></h5><button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="material-icons">clear</i></button></div><div class="modal-body"><div class="input-group input-group-sm search-form"><input autofocus id="search-county" onkeypress="SearchEngine.searchCountyByEnterKey(event)" type="text" class="form-control" placeholder="'+Translation[Lang.language].txt1g+'"><label><button class="btn btngreen btnsearch" onclick="SearchEngine.search()"><i class="material-icons">search</i></button></label></div><div id="selectool" style="display:none;"><input type="checkbox" id="btnSelectool" onclick="SearchEngine.enableDisableAll()"><span class="txtgreen"> '+Translation[Lang.language].txt1h+'</span></div><div class="counties-list"><ul id="filtered-list"></ul></div><div id="missing_area" style="display:none;"><br/><span style="color: red;">*</span><span class="disable-li"> '+Translation[Lang.language].txt1w+'</span></div></div><div class="modal-footer"><div class="checkbox pull-right"><label><button type="button" class="btn btngreen" onclick="SearchEngine.selectPriorityMuns();"><span>'+Translation[Lang.language].txt1p+'</span></button></label>&nbsp;<label><button type="button" class="btn btngreen" data-dismiss="modal"><span>'+Translation[Lang.language].txt1i+"</span></button></label></div></div></div></div></div>";$("#"+SearchEngine.modalContent).html(modalHTML)},enableDisableAll:function(){SearchEngine.enableCtl=!SearchEngine.enableCtl;let fl=$("#filtered-list li");fl.length&&fl.each((i,li)=>{li.className=SearchEngine.enableCtl?"enable-li":""}),SearchEngine.msf=[],SearchEngine.enableCtl&&SearchEngine.msf_ui.length&&SearchEngine.msf_ui.forEach(item=>{SearchEngine.msf.push(item.key)})},enableDisableItem:function(id){let li=$("#idmun_"+id);if(li.length)if(li=li[0],li.className=""==li.className?"enable-li":"",""==li.className){if(SearchEngine.msf.length){let ids=SearchEngine.msf.findIndex(it=>it==SearchEngine.msf_ui[id].key);SearchEngine.msf.splice(ids,1)}}else SearchEngine.msf.push(SearchEngine.msf_ui[id].key)},searchCountyByEnterKey:function(key){return 13==key.keyCode&&SearchEngine.search(),key},search:function(){var r=SearchEngine.findInArray(SearchEngine.msf_all,$("#search-county")[0].value);r.length>0?this.msf_ui=r:this.msf_ui=[],this.showFilteredItems()},showFilteredItems:function(){$("#missing_area").hide(),0==this.msf_ui.length?$("#selectool").hide():$("#selectool").show(),document.getElementById("filtered-list").innerHTML=0==this.msf_ui.length?Translation[Lang.language].without:"",this.msf_ui.forEach((function(o,id){var m=o.key.replace("'","Â´");let clazz=SearchEngine.msf.includes(o.key)?"enable-li":"";o.value?document.getElementById("filtered-list").innerHTML+="<li id='idmun_"+id+"' class='"+clazz+"'><a href=\"javascript:SearchEngine.enableDisableItem('"+id+"');\">"+m+"</a></li>":($("#missing_area").show(),document.getElementById("filtered-list").innerHTML+="<li id='idmun_"+id+"' class='disable-li'>"+m+" <span style='color: red;'>*</span></li>")})),$("#modal-container-filtered").modal("show")},findInArray:function(anArray,substring){var found;return substring=substring.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),$.grep(anArray,(function(value,i){return value.key.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").indexOf(substring)>=0}))},findUsingStates:function(anArray,states){var found=[];return states.forEach(state=>{found=found.concat($.grep(anArray,(function(value,i){return value.key.split("/")[1]===state})))}),found},applyCountyFilter:function(d,multiselection){(multiselection=void 0!==multiselection)||d&&d.length?(this.top10ByMunChartReference.data((function(group){var filteredGroup=[],index,allItems=group.top(1/0);let dkey=multiselection?d[0][d[0].length-1]:d[d.length-1].key;allItems.findIndex((function(item,i){item.key==dkey&&(index=i,filteredGroup.push({key:item.key,value:item.value}))}));for(var ctl=1,max=[],min=[];ctl<=5;){var item=allItems[index+ctl];item&&min.push({key:item.key,value:item.value}),(item=allItems[index-ctl])&&max.push({key:item.key,value:item.value}),++ctl}return filteredGroup=filteredGroup.concat(max),min.reverse(),(filteredGroup=min.concat(filteredGroup)).reverse(),filteredGroup})),multiselection?(this.top10ByMunChartReference.filterAll(),SearchEngine.top10ByMunChartReference.filter(d)):this.top10ByMunChartReference.filter(d[d.length-1].key)):(this.top10ByMunChartReference.data((function(group){var fakeGroup=[];return fakeGroup.push({key:Translation[Lang.language].no_value,value:0}),group.all().length>0?group.top(10):fakeGroup})),this.top10ByMunChartReference.filterAll(),this.msf=[]),dc.redrawAll()},showAllMunicipalityList:function(){document.getElementById("filtered-list").innerHTML="";let allMun=this.munGroup;this.msf_ui=[],allMun.forEach(mg=>{SearchEngine.msf_ui.push({key:mg.key,value:mg.value})}),SearchEngine.msf_all=SearchEngine.msf_ui,this.showFilteredItems()},selectPriorityMuns:function(){SearchEngine.msf.length?(SearchEngine.applyCountyFilter([SearchEngine.msf],!0),$("#modal-container-filtered").modal("hide")):SearchEngine.applyCountyFilter()},showContextMuns:function(){$("#search-county")[0].value="",this.showAllMunicipalityList()},updateSelectedList:function(){if(SearchEngine.top10ByMunChartReference.hasFilter()){let sfc=SearchEngine.top10ByMunChartReference.filters();sfc.length&&sfc.forEach(o=>{SearchEngine.msf.includes(o)||SearchEngine.msf.push(o)}),SearchEngine.msf.length&&SearchEngine.msf.forEach((o,i)=>{sfc.includes(o)||SearchEngine.msf.splice(i,1)})}else SearchEngine.msf=[]}};