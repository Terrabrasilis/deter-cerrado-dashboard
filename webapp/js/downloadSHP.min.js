let downloadCtrl={project:null,homologation:"",serviceBaseUrl:"/file-delivery",getFileDeliveryURL(){return this.inferHomologationByURI(),this.serviceBaseUrl=this.inferLocalhost()+"/"+this.homologation+"file-delivery",this.serviceBaseUrl},getDownloadTime(){let dt=new Date;return dt=dt.toLocaleDateString()+"-"+dt.toLocaleTimeString(),dt=dt.split("/").join("-"),""+dt},getProject(){return this.inferProjectByURI(),this.project},inferProjectByURI(){var URL=document.location.href;URL.includes("amazon")?this.project="deter-amz":URL.includes("cerrado")&&(this.project="deter-cerrado-nb")},inferHomologationByURI(){var URL;document.location.href.includes("homologation")&&(this.homologation="homologation/")},inferLocalhost(){return this.isLocalhost()?this.getTerraBrasilisHref():""},inferProtocol:()=>document.location.protocol,isLocalhost(){let orig=document.location.origin;return orig.includes("localhost")||orig.includes("127")},getTerraBrasilisHref:()=>document.location.protocol+"//"+document.location.hostname,startDownload(){this.project||this.inferProjectByURI(),$("#download-shp-icon").html('<img src="img/loader.svg" />'),this.downloadShapefile()},downloadShapefile(){let anchor=document.createElement("a");document.body.appendChild(anchor);let file=this.getFileDeliveryURL()+"/download/"+this.project+"/shape",headers=new Headers;headers.append("Authorization","Bearer "+Authentication.getToken());let fileName=this.project+"-"+this.getDownloadTime()+".zip";fetch(file,{headers:headers}).then(response=>response.blob()).then(blobby=>{let objectUrl=window.URL.createObjectURL(blobby);anchor.href=objectUrl,anchor.download=fileName,anchor.click(),window.URL.revokeObjectURL(objectUrl)}).finally(()=>{$("#download-shp-icon").html('<i class="material-icons">save_alt</i>')})}};