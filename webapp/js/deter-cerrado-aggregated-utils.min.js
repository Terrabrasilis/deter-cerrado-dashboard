var utils={config:{},statusPrint:!1,btnPrintPage:function(){d3.select("#prepare_print").on("click",(function(){utils.preparePrint()}))},displayLoginExpiredMessage(){"undefined"!=typeof Authentication&&Authentication.isExpiredToken()?(d3.select("#expired_token_box").style("display",""),Authentication.removeExpiredToken()):d3.select("#expired_token_box").style("display","none")},getDefaultHeight:function(){return 1*(.4*window.innerHeight).toFixed(0)},getSeriesChartWidth:function(){return $("#agreg").width()},btnDownload:function(){d3.select("#download-csv-monthly-all").on("click",(function(){var blob=new Blob([d3.csv.format(graph.data)],{type:"text/csv;charset=utf-8"});saveAs(blob,downloadCtrl.getProject()+"-aggregated-"+downloadCtrl.getDownloadTime()+".csv")})),d3.select("#download-csv-monthly").on("click",(function(){var filteredData=graph.monthDimension.top(1/0),blob=new Blob([d3.csv.format(filteredData)],{type:"text/csv;charset=utf-8"});saveAs(blob,downloadCtrl.getProject()+"-aggregated-"+downloadCtrl.getDownloadTime()+".csv")})),d3.select("#download-shp").on("click",(function(){downloadCtrl.startDownload()}))},preparePrint:function(){d3.select("#print_information").style("display","block"),d3.select("#print_page").on("click",(function(){d3.select("#print_information").style("display","none"),window.print()}))},btnOnOffCloudDefor:function(){$("#cloud-selector").on("change",(function(){let cookieCloudNotice=EasyCookie.read("cloudNotice");$("#cloud-selector")[0].checked&&null===cookieCloudNotice&&$("#cloudNotice").modal("show"),graph.changeCloudStatus($("#cloud-selector")[0].checked)})),$("#defor-selector").on("change",(function(){graph.changeDeforStatus($("#defor-selector")[0].checked)}))},btnChangeCalendar:function(){$("#change-calendar input").on("change",(function(){graph.changeCalendar($("input[name=calendars]:checked","#change-calendar").attr("id"))}))},attachEventListeners:function(){utils.btnPrintPage(),utils.btnDownload(),utils.btnOnOffCloudDefor()},attachListenersToLegend:function(){for(var legendItems=$("#agreg .dc-legend-item"),i=0;i<legendItems.length;i++)$(legendItems[i]).on("click",(function(ev){graph.barAreaByYear.filter(ev.currentTarget.textContent.split(" ")[0])}))},onResize:function(event){clearTimeout(utils.config.resizeTimeout),utils.config.resizeTimeout=setTimeout(graph.doResize,200)},renderAll:function(){dc.renderAll("agrega"),dc.renderAll("filtra"),d3.selectAll("circle").attr("r",(function(){return 5})).on("mouseout.foo",(function(){d3.select(this).attr("r",(function(){return 5}))}))},snapToZero:function(sourceGroup){return{all:function(){return sourceGroup.all().map((function(d){return{key:d.key,value:Math.abs(d.value)<1e-6?0:d.value}}))}}},rangesEqual:function(range1,range2){return!range1&&!range2||!(!range1||!range2)&&(0===range1.length&&0===range2.length||range1[0].valueOf()===range2[0].valueOf()&&range1[1].valueOf()===range2[1].valueOf())},xaxis:function(d){var list=[];return"prodes"==graph.calendarConfiguration?(list=Translation[Lang.language].months_of_prodes_year)[d-8]:(list=Translation[Lang.language].months_of_civil_year)[d-1]},monthYearList:function(monthNumber,month,years){var fy=[];return"prodes"==graph.calendarConfiguration?years.forEach(y=>{monthNumber>=13&&monthNumber<=19&&fy.push(y.split("/")[1]),monthNumber>=8&&monthNumber<=12&&fy.push(y.split("/")[0])}):fy=years,fy.sort(),month+"/("+fy.join(", ")+")"},nameMonthsById:function(id){let list={},month_names=[],offset=0;"prodes"==graph.calendarConfiguration?(month_names=Translation[Lang.language].months_of_prodes_year,offset=8):(month_names=Translation[Lang.language].months_of_civil_year,offset=1);for(let i=0;i<12;i++)list[i+offset]=month_names[i];return list[id]},fakeMonths:function(d){var list=[],m=1;return m="prodes"==graph.calendarConfiguration?(list=[13,14,15,16,17,18,19,8,9,10,11,12])[d-1]:d},displayWarning:function(enable){void 0===enable&&(enable=!0),document.getElementById("warning_data_info").style.display=enable?"":"none",document.getElementById("warning_data_info").innerHTML='<h3><span id="txt7">'+Translation[Lang.language].txt7+"</span></h3>",document.getElementById("loading_data_info").style.display=enable?"none":""},displayGraphContainer:function(){d3.select("#panel_container").style("display","block")},displayWaiting:function(enable){void 0===enable&&(enable=!0),d3.select("#charts-panel").style("display",enable?"none":""),d3.select("#loading_data_info").style("display",enable?"":"none"),d3.select("#info_container").style("display",enable?"":"none"),d3.select("#panel_container").style("display",enable?"none":""),d3.select("#warning_data_info").style("display","none"),d3.select("#radio-area").style("display",enable?"none":""),d3.select("#radio-alerts").style("display",enable?"none":"")},highlightSelectedMonths:function(){let iMin="prodes"==graph.calendarConfiguration?8:1,iMax="prodes"==graph.calendarConfiguration?20:13;for(var i=iMin;i<iMax;i++)graph.monthFilters.includes(i)||!graph.monthFilters.length?d3.select("#month_"+i).style("opacity","1"):d3.select("#month_"+i).style("opacity","0.4")},setMonthNamesFilterBar:function(){let iMin="prodes"==graph.calendarConfiguration?8:1,iMax="prodes"==graph.calendarConfiguration?20:13;for(var i=iMin;i<iMax;i++)d3.select("#month_"+i).html("prodes"==graph.calendarConfiguration?Translation[Lang.language].months_of_prodes_year[i-8]:Translation[Lang.language].months_of_civil_year[i-1])},moveBars:chart=>{let offsetBars=18,years=graph.yearGroup0.all(),mr=graph.lineSeriesMonthly.margins().right,ml=graph.lineSeriesMonthly.margins().left,wl=(graph.lineSeriesMonthly.width()-mr-ml)/18,l=years.length,l2=parseInt(wl/l),start=-1*parseInt(wl-wl/2);chart.selectAll("g.sub").selectAll("rect.bar").forEach((sub,i)=>{sub.length&&(chart.selectAll("g.sub._"+i).attr("transform","translate("+start+", 0)"),start+=l2)})},makeMonthsChooserList:function(){let magicNumber=14,width=parseInt(utils.getSeriesChartWidth()/14),template="",extra='<div style="width:'+width+'px;"></div>',iMin="prodes"==graph.calendarConfiguration?8:1,iMax="prodes"==graph.calendarConfiguration?20:13;for(var i=iMin;i<iMax;i++)template+='<div style="width:'+width+'px;" id="month_'+i+'" class="month_box" onclick="graph.applyMonthFilter('+i+')"></div>';template=extra+template+extra,$("#months_chooser").html(template),utils.setMonthNamesFilterBar()}};